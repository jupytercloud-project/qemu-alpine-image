version: 2.1

executors:
  vm:
    machine:
      enabled: true
      image: circleci/classic:latest

jobs:
  build:
    executor: vm
    shell: /bin/bash --login -eo pipefail 
    steps:
    - run:
        name: Install dev tools
        command: sudo apt-get install build-essential
    - run:
        name: Install Brew
        command: sh -c "$(curl -fsSL https://raw.githubusercontent.com/Linuxbrew/install/master/install.sh)"
    - run:
        name: Add brew to the PATH
        command: |
          echo 'eval $(/home/linuxbrew/.linuxbrew/bin/brew shellenv)' >> ~/.bash_profile
    - run:
        name: Installing qemu
        command: apt-get install qemu
        no_output_timeout: 60m
    - run:
        name: Installing packer
        command: brew install packer
        no_output_timeout: 60m
    - run: packer --help
